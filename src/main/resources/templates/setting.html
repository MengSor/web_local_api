<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>API Security</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>

<div class="d-flex">
    <!-- Sidebar fragment -->
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>

    <main class="flex-fill p-4">
        <h2 class="mb-4">API Security</h2>

        <form th:action="@{/page/setting/save}" th:object="${settingCache}" method="post" class="card p-4 shadow-sm">

            <!-- Security Mode -->
            <div class="mb-3">
                <label class="form-label">Security Mode</label>
                <select class="form-select" name="securityMode" id="securityMode" th:field="${settingCache.securityMode}">
                    <option value="NONE">None</option>
                    <option value="BASIC">Basic Auth</option>
                </select>

            </div>

            <!-- BASIC AUTH FIELDS -->
            <div id="basicAuthFields" style="display:none;">
                <div class="mb-3">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-control" name="username" required th:value="${settingCache.username != null ? settingCache.username : ''}">
                </div>

                <div class="mb-3">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" name="password" required th:value="${settingCache.password != null ? settingCache.password : ''}">
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Save</button>
        </form>

        <!-- Success message -->
        <div class="mt-3 text-success" th:text="${message}"></div>
    </main>
</div>

<script>
    function toggleAuthFields() {
        const select = document.getElementById("securityMode");
        const fields = document.getElementById("basicAuthFields");

        if (select.value === "BASIC") {
            fields.style.display = "block";
        } else {
            fields.style.display = "none";
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        toggleAuthFields();
        document.getElementById("securityMode").addEventListener("change", toggleAuthFields);
    });
</script>

</body>
</html>
